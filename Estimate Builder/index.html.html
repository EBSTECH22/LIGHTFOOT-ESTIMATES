<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Lightfoot Roofs - Estimate Builder</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Outfit', sans-serif; background: #f2f2f2; overflow-x: hidden; }
  input, select, textarea, button { font-family: 'Outfit', sans-serif; box-sizing: border-box; }
  @media print { .noprint { display: none !important; } }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
var useState = React.useState;

var R = "#c5232e";
var B = "#111";
var W = "#fff";
var G1 = "#333";
var G2 = "#666";
var G3 = "#999";
var G4 = "#d0d0d0";
var G5 = "#f2f2f2";
var LR = "#fdedef";
var GN = "#2d8a4e";
var F = "'Outfit',sans-serif";

var SHINGLES = [
  { id: "ns", n: "GAF Natural Shadow", p: 400, c: 252, d: "" },
  { id: "hdz", n: "GAF HDZ", p: 420, c: 267, d: "Class 3, Infinite Wind" },
  { id: "as2", n: "GAF Armor Shield II", p: 475, c: 298, d: "Class 4" },
  { id: "uhdz", n: "GAF UHDZ", p: 495, c: null, d: "Fancy Colors" },
  { id: "mv", n: "Malarkey Vista", p: 445, c: 280, d: "Class 4" },
  { id: "tt", n: "Tamko Titan XT", p: 425, c: null, d: "Class 3" },
  { id: "ts", n: "Tamko StormFighter Flex 4", p: 450, c: null, d: "Class 4, Cold Install" },
  { id: "ocd", n: "Owens Corning Duration", p: 420, c: null, d: "Colorful" },
];
var LOWSLOPE = [
  { id: "mb", n: "Modified Bitumen (Mod Bit)", p: 550, c: 85, u: "sq" },
  { id: "tpo", n: "TPO", p: 1350, c: null, u: "sq" },
];
var GUTTERS_DATA = [
  { id: "g5", n: '5" Gutters', p: 8.8, c: null, u: "LF" },
  { id: "s5", n: '5" Screens', p: 5.5, c: null, u: "LF" },
  { id: "g6", n: '6" Gutters', p: 13.6, c: null, u: "LF" },
  { id: "s6", n: '6" Screens', p: 6.5, c: null, u: "LF" },
  { id: "gc", n: "Gutter Cleaning", p: 3.5, c: null, u: "LF" },
];
var SIDING_DATA = [
  { id: "wf", n: "Wood Fascia", p: 9, c: null, u: "LF" },
  { id: "mf", n: "Metal Fascia", p: 12.5, c: null, u: "LF" },
  { id: "pf", n: "Paint Fascia", p: 5, c: null, u: "LF" },
  { id: "vs", n: "Vinyl Siding", p: 1000, c: null, u: "sq" },
  { id: "hb", n: "Hardie Board", p: 1600, c: null, u: "sq" },
  { id: "lps", n: "LP Smart Siding", p: 1400, c: null, u: "sq" },
];
var PIT = [
  { l: "Normal (under 9/12)", v: 0, c: 0, p: 0 },
  { l: "9/12", v: 1, c: 10, p: 16 },
  { l: "10/12", v: 2, c: 20, p: 32 },
  { l: "11/12", v: 3, c: 30, p: 48 },
  { l: "12/12", v: 4, c: 40, p: 64 },
  { l: "13/12", v: 5, c: 50, p: 80 },
  { l: "14/12", v: 6, c: 60, p: 96 },
];
var CRK = [
  { l: "Small", p: 350, c: 250 },
  { l: "Medium", p: 490, c: 350 },
  { l: "Large", p: 560, c: 400 },
];

function fm(n) {
  if (n == null) return "N/A";
  return "$" + Number(n).toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function genEstNum() {
  var now = new Date();
  var year = now.getFullYear();
  var yearsInBiz = year - 2023;
  var dayOfYear = Math.floor((now - new Date(year, 0, 0)) / 86400000);
  var minuteOfDay = now.getHours() * 60 + now.getMinutes();
  var seq = dayOfYear * 100 + Math.floor(minuteOfDay / 15);
  return String(yearsInBiz) + String(seq).padStart(3, "0");
}

function Logo(props) {
  var s = props.size || 32;
  var c = props.color || W;
  return (
    <svg width={s} height={s} viewBox="0 0 100 100" fill="none">
      <path d="M50 8L26 44h14v18H24L50 16l26 30H60V44h14L50 8z" fill={c} />
      <path d="M32 66v22h14V74h8v14h14V66H32z" fill={c} />
      <rect x="18" y="92" width="64" height="3" rx="1" fill={c} />
    </svg>
  );
}

var labelStyle = { fontSize: 11, fontWeight: 700, color: G3, textTransform: "uppercase", letterSpacing: 1, fontFamily: F, marginBottom: 4, display: "block" };
var fieldStyle = { width: "100%", padding: "10px 12px", border: "1.5px solid " + G4, borderRadius: 4, fontSize: 15, fontFamily: F, color: B, background: W, outline: "none" };

function Field(props) {
  return (
    <div style={{ marginBottom: 12 }}>
      {props.label ? <label style={labelStyle}>{props.label}</label> : null}
      <input type={props.type || "text"} value={props.value} onChange={function(e) { props.onChange(e.target.value); }} placeholder={props.ph || ""} style={fieldStyle} />
    </div>
  );
}

function NumField(props) {
  return (
    <div style={{ marginBottom: 12 }}>
      {props.label ? <label style={labelStyle}>{props.label}</label> : null}
      <input type="number" value={props.value} onChange={function(e) { props.onChange(parseFloat(e.target.value) || 0); }} min={0} step={props.step || 1} style={fieldStyle} />
    </div>
  );
}

function Section(props) {
  return (
    <div style={{ background: W, borderRadius: 6, padding: 20, marginBottom: 14, boxShadow: "0 1px 3px rgba(0,0,0,0.06)", borderTop: props.accent ? "3px solid " + props.accent : "none" }}>
      <div style={{ fontSize: 14, fontWeight: 700, letterSpacing: 1.5, textTransform: "uppercase", marginBottom: 16, paddingBottom: 8, borderBottom: "2px solid " + G4, fontFamily: F, color: B }}>{props.title}</div>
      {props.children}
    </div>
  );
}

function App() {
  var cs = useState(false), showCost = cs[0], setShowCost = cs[1];
  var au = useState(false), costUnlocked = au[0], setCostUnlocked = au[1];
  var pw = useState(false), showPwModal = pw[0], setShowPwModal = pw[1];
  var pwv = useState(""), pwVal = pwv[0], setPwVal = pwv[1];
  var pwe = useState(""), pwErr = pwe[0], setPwErr = pwe[1];
  var pr = useState(false), isPrint = pr[0], setIsPrint = pr[1];
  var cu = useState({ name: "", addr: "", city: "", st: "OK", zip: "", ph: "", em: "" }), cust = cu[0], setCust = cu[1];
  var rp = useState({ name: "", ph: "", em: "" }), rep = rp[0], setRep = rp[1];
  var ed = useState(new Date().toISOString().split("T")[0]), eDate = ed[0], setEDate = ed[1];
  var en = useState(function() { return genEstNum(); }), eNum = en[0], setENum = en[1];
  var no = useState(""), notes = no[0], setNotes = no[1];
  var sh = useState(""), shingle = sh[0], setShingle = sh[1];
  var sq1 = useState(0), sqVal = sq1[0], setSqVal = sq1[1];
  var pi = useState(0), pitch = pi[0], setPitch = pi[1];
  var tw = useState(false), isTwoStory = tw[0], setTwoStory = tw[1];
  var es2 = useState(0), exSh = es2[0], setExSh = es2[1];
  var ef2 = useState(0), exFe = ef2[0], setExFe = ef2[1];
  var dk = useState(0), deckSq = dk[0], setDeckSq = dk[1];
  var cr = useState([]), crks = cr[0], setCrks = cr[1];
  var ls1 = useState(0), lgSf = ls1[0], setLgSf = ls1[1];
  var ll = useState(0), lgLf = ll[0], setLgLf = ll[1];
  var lo = useState({}), lsV = lo[0], setLsV = lo[1];
  var gu = useState({}), gtV = gu[0], setGtV = gu[1];
  var si = useState({}), sdV = si[0], setSdV = si[1];
  var ci = useState([]), cisV = ci[0], setCisV = ci[1];
  var ins = useState(false), isInsurance = ins[0], setIsInsurance = ins[1];
  var ic = useState({ company: "", claim: "", dol: "", acv: "" }), insClaim = ic[0], setInsClaim = ic[1];

  function handleCostToggle() {
    if (!costUnlocked) { setShowPwModal(true); setPwVal(""); setPwErr(""); }
    else { setShowCost(!showCost); }
  }
  function handlePwSubmit() {
    if (pwVal === "HeSaves8693") { setCostUnlocked(true); setShowCost(true); setShowPwModal(false); setPwVal(""); setPwErr(""); }
    else { setPwErr("Incorrect code."); setPwVal(""); }
  }

  var lines = [];
  var shObj = SHINGLES.find(function(s) { return s.id === shingle; });
  if (shObj && sqVal > 0) lines.push({ d: shObj.n + (shObj.d ? " (" + shObj.d + ")" : "") + " - " + sqVal + " sq", det: "Includes tear-off, underlayment, flashing, ridge cap", t: sqVal * shObj.p, tc: shObj.c != null ? sqVal * shObj.c : null });
  var pitObj = PIT[pitch];
  if (pitObj && pitObj.v > 0 && sqVal > 0) lines.push({ d: "Steep Charge (" + pitObj.l + ") - " + sqVal + " sq", t: sqVal * pitObj.p, tc: sqVal * pitObj.c });
  if (isTwoStory && sqVal > 0) lines.push({ d: "2nd Story Charge - " + sqVal + " sq", t: sqVal * 25, tc: sqVal * 15 });
  if (deckSq > 0) lines.push({ d: "OSB Decking Overlay - " + deckSq + " sq", t: deckSq * 200, tc: deckSq * 175 });
  if (exSh > 0 && sqVal > 0) lines.push({ d: "Extra Shingle Layer (x" + exSh + ") - " + sqVal + " sq", t: sqVal * exSh * 40, tc: sqVal * exSh * 25 });
  if (exFe > 0 && sqVal > 0) lines.push({ d: "Extra Felt Layer (x" + exFe + ") - " + sqVal + " sq", t: sqVal * exFe * 8, tc: sqVal * exFe * 5 });
  crks.forEach(function(idx) { var c = CRK[idx]; lines.push({ d: "Cricket - " + c.l, t: c.p, tc: c.c }); });
  if (lgSf > 0) lines.push({ d: "Leak Guard - " + lgSf + " sq ft", t: lgSf * 1.6, tc: null });
  if (lgLf > 0) lines.push({ d: "Leak Guard - " + lgLf + " LF", t: lgLf * 4.8, tc: null });
  LOWSLOPE.forEach(function(x) { var q = lsV[x.id] || 0; if (q > 0) lines.push({ d: x.n + " - " + q + " sq", t: q * x.p, tc: x.c != null ? q * x.c : null }); });
  GUTTERS_DATA.forEach(function(x) { var q = gtV[x.id] || 0; if (q > 0) lines.push({ d: x.n + " - " + q + " " + x.u, t: q * x.p, tc: x.c != null ? q * x.c : null }); });
  SIDING_DATA.forEach(function(x) { var q = sdV[x.id] || 0; if (q > 0) lines.push({ d: x.n + " - " + q + " " + x.u, t: q * x.p, tc: x.c != null ? q * x.c : null }); });
  cisV.forEach(function(x) { if (x.de && x.qty > 0) lines.push({ d: x.de + " - " + x.qty + " " + x.unit, t: x.qty * x.pr, tc: x.co ? x.qty * x.co : null }); });

  var tot = 0, totC = 0;
  lines.forEach(function(l) { tot += l.t; totC += (l.tc || 0); });
  var prof = tot - totC;
  var marg = tot > 0 ? ((prof / tot) * 100).toFixed(1) : "0";
  var final2 = tot > 0 ? Math.max(tot, 500) : 0;

  // ===== PRINT VIEW =====
  if (isPrint) {
    return (
      <div style={{ fontFamily: F, background: W, color: B, padding: 30, maxWidth: 800, margin: "0 auto" }}>
        <div className="noprint" style={{ marginBottom: 20, display: "flex", gap: 12, flexWrap: "wrap" }}>
          <button onClick={function() { window.print(); }} style={{ padding: "10px 24px", background: B, color: W, border: "none", borderRadius: 4, cursor: "pointer", fontWeight: 700, fontFamily: F }}>PRINT / SAVE PDF</button>
          <button onClick={function() { setIsPrint(false); }} style={{ padding: "10px 24px", background: G5, color: B, border: "1px solid " + G4, borderRadius: 4, cursor: "pointer", fontWeight: 600, fontFamily: F }}>Back to Builder</button>
        </div>

        <div style={{ paddingBottom: 20, marginBottom: 24, borderBottom: "3px solid " + R }}>
          <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 8 }}>
            <div style={{ background: B, borderRadius: 6, padding: 6, display: "flex", alignItems: "center", justifyContent: "center" }}>
              <Logo size={36} color={W} />
            </div>
            <div>
              <div style={{ fontSize: 18, fontWeight: 800, letterSpacing: 3 }}>LIGHTFOOT</div>
              <div style={{ fontSize: 10, fontWeight: 600, color: G3, letterSpacing: 5 }}>ROOFS</div>
            </div>
          </div>
          <div style={{ fontSize: 12, color: G2, lineHeight: 1.8, marginBottom: 12 }}>(405) 834-4799 | 2236 NW 164th St, Ste 12, Edmond OK 73013 | LightfootRoofs.com</div>
          <div style={{ fontSize: 28, fontWeight: 800, letterSpacing: 2 }}>ESTIMATE</div>
          {eNum ? <div style={{ fontSize: 13, color: G3 }}>#{eNum}</div> : null}
          <div style={{ fontSize: 13, color: G3 }}>{new Date(eDate).toLocaleDateString("en-US", { month: "long", day: "numeric", year: "numeric" })}</div>
        </div>

        <div style={{ background: G5, padding: "14px 18px", borderRadius: 4, borderLeft: "4px solid " + R, marginBottom: 12 }}>
          <div style={{ fontSize: 10, fontWeight: 700, color: G3, textTransform: "uppercase", letterSpacing: 1.5, marginBottom: 4 }}>Prepared For</div>
          <div style={{ fontSize: 15, fontWeight: 700 }}>{cust.name || "---"}</div>
          <div style={{ fontSize: 13, color: G2, marginTop: 2 }}>
            {cust.addr ? <div>{cust.addr}</div> : null}
            {(cust.city || cust.st || cust.zip) ? <div>{[cust.city, cust.st].filter(Boolean).join(", ")} {cust.zip}</div> : null}
            {cust.ph ? <div>{cust.ph}</div> : null}
            {cust.em ? <div>{cust.em}</div> : null}
          </div>
        </div>
        <div style={{ background: G5, padding: "14px 18px", borderRadius: 4, borderLeft: "4px solid " + B, marginBottom: 20 }}>
          <div style={{ fontSize: 10, fontWeight: 700, color: G3, textTransform: "uppercase", letterSpacing: 1.5, marginBottom: 4 }}>Your Representative</div>
          <div style={{ fontSize: 15, fontWeight: 700 }}>{rep.name || "---"}</div>
          <div style={{ fontSize: 13, color: G2, marginTop: 2 }}>
            {rep.ph ? <div>{rep.ph}</div> : null}
            {rep.em ? <div>{rep.em}</div> : null}
          </div>
        </div>

        {isInsurance && (insClaim.company || insClaim.claim) ? (
          <div style={{ background: "#f8f8ff", padding: "12px 18px", borderRadius: 4, marginBottom: 20, borderLeft: "4px solid " + G2 }}>
            <div style={{ fontSize: 10, fontWeight: 700, color: G3, textTransform: "uppercase", letterSpacing: 1.5, marginBottom: 4 }}>Insurance Claim</div>
            <div style={{ fontSize: 13, color: G1 }}>
              {insClaim.company ? <div><strong>Company:</strong> {insClaim.company}</div> : null}
              {insClaim.claim ? <div><strong>Claim #:</strong> {insClaim.claim}</div> : null}
              {insClaim.dol ? <div><strong>Date of Loss:</strong> {new Date(insClaim.dol).toLocaleDateString("en-US")}</div> : null}
              {insClaim.acv ? <div><strong>ACV Amount:</strong> {fm(parseFloat(insClaim.acv))}</div> : null}
            </div>
          </div>
        ) : null}

        <table style={{ width: "100%", borderCollapse: "collapse", marginBottom: 20 }}>
          <thead><tr style={{ borderBottom: "2px solid " + B }}>
            <th style={{ textAlign: "left", padding: "8px 6px", fontSize: 10, fontWeight: 700, color: G3, textTransform: "uppercase", letterSpacing: 1 }}>Description</th>
            <th style={{ textAlign: "right", padding: "8px 6px", fontSize: 10, fontWeight: 700, color: G3, textTransform: "uppercase", letterSpacing: 1 }}>Amount</th>
          </tr></thead>
          <tbody>
            {lines.map(function(l, i) {
              return (<tr key={i} style={{ borderBottom: "1px solid " + G4 }}>
                <td style={{ padding: "10px 6px", fontSize: 13 }}>{l.d}{l.det ? <div style={{ fontSize: 11, color: G3, marginTop: 2 }}>{l.det}</div> : null}</td>
                <td style={{ padding: "10px 6px", fontSize: 14, fontWeight: 700, textAlign: "right", whiteSpace: "nowrap" }}>{fm(l.t)}</td>
              </tr>);
            })}
          </tbody>
        </table>

        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", padding: "14px 18px", background: B, borderRadius: 4, marginBottom: 24 }}>
          <span style={{ fontSize: 16, fontWeight: 700, color: W, letterSpacing: 1 }}>TOTAL</span>
          <span style={{ fontSize: 22, fontWeight: 800, color: W }}>{fm(final2)}</span>
        </div>

        <div style={{ background: G5, padding: "14px 18px", borderRadius: 4, borderLeft: "4px solid " + R, marginBottom: 10 }}>
          <div style={{ fontSize: 10, fontWeight: 700, color: G3, textTransform: "uppercase", letterSpacing: 1.5, marginBottom: 4 }}>Warranty</div>
          <div style={{ fontSize: 13, color: G1, lineHeight: 1.7 }}>Backed by the <strong>GAF Certified 50-Year Warranty</strong> on materials and a <strong>5-Year Labor Warranty</strong> by Lightfoot Roofs.</div>
        </div>
        <div style={{ background: G5, padding: "14px 18px", borderRadius: 4, borderLeft: "4px solid " + B, marginBottom: 10 }}>
          <div style={{ fontSize: 10, fontWeight: 700, color: G3, textTransform: "uppercase", letterSpacing: 1.5, marginBottom: 4 }}>Payment Terms</div>
          <div style={{ fontSize: 13, color: G1, lineHeight: 1.7 }}>A <strong>50% deposit</strong> is required prior to work commencing, or the <strong>total ACV amount</strong> on insurance claims â€” whichever is higher. Balance is due upon completion.</div>
        </div>
        <div style={{ background: "#fffbeb", padding: "14px 18px", borderRadius: 4, border: "1px solid #e8ddb5", marginBottom: 10 }}>
          <div style={{ fontSize: 12, color: "#6b5c1f", lineHeight: 1.7 }}><strong>Please Note:</strong> Pricing shown is an estimate and is not final. Any changes to scope, materials, or pricing will be discussed and agreed upon with the homeowner before work is completed.</div>
        </div>
        {notes ? <div style={{ background: G5, padding: "14px 18px", borderRadius: 4, borderLeft: "4px solid " + G4, marginBottom: 10 }}>
          <div style={{ fontSize: 10, fontWeight: 700, color: G3, textTransform: "uppercase", letterSpacing: 1.5, marginBottom: 4 }}>Notes</div>
          <div style={{ fontSize: 13, color: G2, whiteSpace: "pre-wrap", lineHeight: 1.7 }}>{notes}</div>
        </div> : null}

        <div style={{ marginTop: 36 }}>
          <div style={{ borderBottom: "1px solid " + B, marginBottom: 6, height: 40 }}></div>
          <div style={{ fontSize: 11, color: G3, marginBottom: 20 }}>Homeowner Signature & Date</div>
        </div>
        <div style={{ fontSize: 11, color: G3, lineHeight: 1.6 }}>By signing above, I accept this estimate and authorize Lightfoot Roofs to proceed with the work described. I agree to the payment terms outlined above.</div>
        <div style={{ marginTop: 24, textAlign: "center", fontSize: 11, color: G4, borderTop: "1px solid " + G4, paddingTop: 14 }}>This estimate is valid for 30 days. Thank you for choosing Lightfoot Roofs.</div>
      </div>
    );
  }

  // ===== BUILDER =====
  return (
    <div style={{ fontFamily: F, background: G5, minHeight: "100vh", color: B }}>
      <div style={{ background: B, padding: "12px 16px", textAlign: "center", position: "sticky", top: 0, zIndex: 100, boxShadow: "0 2px 12px rgba(0,0,0,0.3)" }}>
        <div style={{ display: "flex", alignItems: "center", justifyContent: "center", gap: 8, marginBottom: 8 }}>
          <Logo size={24} color={W} />
          <span style={{ fontSize: 14, fontWeight: 800, color: W, letterSpacing: 2 }}>LIGHTFOOT ROOFS</span>
        </div>
        <div style={{ display: "flex", alignItems: "center", justifyContent: "center", gap: 12, flexWrap: "wrap" }}>
          <label style={{ display: "flex", alignItems: "center", gap: 6, cursor: "pointer", fontSize: 12, color: showCost ? R : G3, fontWeight: 600 }}>
            <input type="checkbox" checked={showCost} onChange={handleCostToggle} style={{ accentColor: R }} /> INTERNAL COSTS
          </label>
          <button onClick={function() { setIsPrint(true); }} style={{ padding: "8px 20px", background: R, color: W, border: "none", borderRadius: 4, fontWeight: 700, fontSize: 12, cursor: "pointer", letterSpacing: 1, fontFamily: F }}>PREVIEW</button>
        </div>
      </div>

      {showPwModal ? <div style={{ background: B, padding: "12px 16px", borderBottom: "2px solid " + R }}>
          <div style={{ maxWidth: 600, margin: "0 auto" }}>
            <div style={{ fontSize: 13, fontWeight: 700, color: W, marginBottom: 8 }}>Enter Admin Code</div>
            <input type="password" value={pwVal} onChange={function(e) { setPwVal(e.target.value); setPwErr(""); }} onKeyDown={function(e) { if (e.key === "Enter") handlePwSubmit(); }} placeholder="Enter code" autoFocus style={{ width: "100%", padding: "10px 12px", border: "1.5px solid " + (pwErr ? R : G4), borderRadius: 4, fontSize: 14, fontFamily: F, color: B, outline: "none", boxSizing: "border-box", marginBottom: 8 }} />
            {pwErr ? <div style={{ fontSize: 12, color: R, marginBottom: 8, fontWeight: 600, background: LR, padding: "6px 10px", borderRadius: 4 }}>{pwErr}</div> : null}
            <div style={{ display: "flex", gap: 8 }}>
              <button onClick={handlePwSubmit} style={{ flex: 1, padding: "10px 16px", background: R, color: W, border: "none", borderRadius: 4, fontWeight: 700, fontSize: 13, cursor: "pointer", fontFamily: F }}>UNLOCK</button>
              <button onClick={function() { setShowPwModal(false); }} style={{ padding: "10px 16px", background: G2, color: W, border: "none", borderRadius: 4, fontWeight: 600, fontSize: 13, cursor: "pointer", fontFamily: F }}>Cancel</button>
            </div>
          </div>
      </div> : null}

      <div style={{ maxWidth: 600, margin: "0 auto", padding: "16px 12px" }}>

        <Section title="Representative Info" accent={R}>
          <Field label="Rep Name" value={rep.name} onChange={function(v) { setRep(Object.assign({}, rep, { name: v })); }} ph="John Doe" />
          <Field label="Rep Phone" value={rep.ph} onChange={function(v) { setRep(Object.assign({}, rep, { ph: v })); }} ph="(405) 555-1234" />
          <Field label="Rep Email" value={rep.em} onChange={function(v) { setRep(Object.assign({}, rep, { em: v })); }} ph="john@lightfootroofs.com" />
        </Section>

        <Section title="Customer Information">
          <Field label="Customer Name" value={cust.name} onChange={function(v) { setCust(Object.assign({}, cust, { name: v })); }} ph="John Smith" />
          <Field label="Phone" value={cust.ph} onChange={function(v) { setCust(Object.assign({}, cust, { ph: v })); }} ph="(405) 555-1234" />
          <Field label="Property Address" value={cust.addr} onChange={function(v) { setCust(Object.assign({}, cust, { addr: v })); }} ph="123 Main St" />
          <Field label="City" value={cust.city} onChange={function(v) { setCust(Object.assign({}, cust, { city: v })); }} ph="Edmond" />
          <Field label="State" value={cust.st} onChange={function(v) { setCust(Object.assign({}, cust, { st: v })); }} />
          <Field label="Zip" value={cust.zip} onChange={function(v) { setCust(Object.assign({}, cust, { zip: v })); }} ph="73013" />
          <Field label="Email" value={cust.em} onChange={function(v) { setCust(Object.assign({}, cust, { em: v })); }} ph="john@email.com" />
          <Field label="Estimate Date" value={eDate} onChange={setEDate} type="date" />
          <Field label="Estimate #" value={eNum} onChange={setENum} ph="Auto-generated" />
        </Section>

        <Section title="Insurance Claim">
          <label style={{ display: "flex", alignItems: "center", gap: 8, fontSize: 14, fontWeight: 600, cursor: "pointer", padding: "10px 12px", background: isInsurance ? LR : G5, borderRadius: 4, border: isInsurance ? "1.5px solid " + R : "1.5px solid transparent", marginBottom: 12 }}>
            <input type="checkbox" checked={isInsurance} onChange={function() { setIsInsurance(!isInsurance); }} style={{ accentColor: R }} /> This is an insurance claim
          </label>
          {isInsurance ? <div>
            <Field label="Insurance Company" value={insClaim.company} onChange={function(v) { setInsClaim(Object.assign({}, insClaim, { company: v })); }} ph="State Farm" />
            <Field label="Claim Number" value={insClaim.claim} onChange={function(v) { setInsClaim(Object.assign({}, insClaim, { claim: v })); }} ph="CLM-12345" />
            <Field label="Date of Loss" value={insClaim.dol} onChange={function(v) { setInsClaim(Object.assign({}, insClaim, { dol: v })); }} type="date" />
            <NumField label="ACV Amount ($)" value={parseFloat(insClaim.acv) || 0} onChange={function(v) { setInsClaim(Object.assign({}, insClaim, { acv: String(v) })); }} step={0.01} />
          </div> : null}
        </Section>

        <Section title="Shingle Roofing">
          <div style={{ marginBottom: 12 }}>
            <label style={labelStyle}>Shingle Type</label>
            <select value={shingle} onChange={function(e) { setShingle(e.target.value); }} style={fieldStyle}>
              <option value="">-- Select Shingle --</option>
              {SHINGLES.map(function(s) { return <option key={s.id} value={s.id}>{s.n}{s.d ? " (" + s.d + ")" : ""} - {fm(s.p)}/sq</option>; })}
            </select>
          </div>
          <NumField label="Squares" value={sqVal} onChange={setSqVal} step={0.1} />
          <div style={{ marginBottom: 12 }}>
            <label style={labelStyle}>Roof Pitch</label>
            <select value={pitch} onChange={function(e) { setPitch(parseInt(e.target.value)); }} style={fieldStyle}>
              {PIT.map(function(p, i) { return <option key={i} value={i}>{p.l}{p.p > 0 ? " (+" + fm(p.p) + "/sq)" : ""}</option>; })}
            </select>
          </div>
          <NumField label="Extra Shingle Layers" value={exSh} onChange={setExSh} />
          <NumField label="Extra Felt Layers" value={exFe} onChange={setExFe} />
          <label style={{ display: "flex", alignItems: "center", gap: 8, fontSize: 14, fontWeight: 600, cursor: "pointer", padding: "10px 12px", background: isTwoStory ? LR : G5, borderRadius: 4, border: isTwoStory ? "1.5px solid " + R : "1.5px solid transparent", marginBottom: 12 }}>
            <input type="checkbox" checked={isTwoStory} onChange={function() { setTwoStory(!isTwoStory); }} style={{ accentColor: R }} /> 2nd Story (+$25/sq)
          </label>
          <NumField label="Decking (sq)" value={deckSq} onChange={setDeckSq} step={0.1} />
          <div style={{ padding: 12, background: G5, borderRadius: 4, marginBottom: 12 }}>
            <div style={{ fontSize: 11, fontWeight: 700, color: G3, textTransform: "uppercase", letterSpacing: 1, marginBottom: 8 }}>Crickets</div>
            <div style={{ display: "flex", gap: 6, flexWrap: "wrap", marginBottom: 8 }}>
              {CRK.map(function(c, i) { return <button key={i} onClick={function() { setCrks(crks.concat([i])); }} style={{ padding: "8px 14px", fontSize: 12, fontWeight: 700, background: B, color: W, border: "none", borderRadius: 4, cursor: "pointer" }}>+ {c.l} ({fm(c.p)})</button>; })}
            </div>
            {crks.map(function(s, i) {
              return (<div key={i} style={{ display: "flex", justifyContent: "space-between", alignItems: "center", padding: "8px 0", borderBottom: "1px solid " + G4 }}>
                <span style={{ fontSize: 13 }}>Cricket - {CRK[s].l}</span>
                <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
                  <span style={{ fontSize: 13, fontWeight: 700 }}>{fm(CRK[s].p)}</span>
                  <button onClick={function() { setCrks(crks.filter(function(_, j) { return j !== i; })); }} style={{ background: LR, color: R, border: "none", borderRadius: 4, padding: "4px 10px", cursor: "pointer", fontSize: 12, fontWeight: 700 }}>X</button>
                </div>
              </div>);
            })}
          </div>
          <NumField label="Leak Guard (sq ft @ $1.60)" value={lgSf} onChange={setLgSf} />
          <NumField label="Leak Guard (LF @ $4.80)" value={lgLf} onChange={setLgLf} />
        </Section>

        <Section title="Low Slope">
          {LOWSLOPE.map(function(x) { return <NumField key={x.id} label={x.n + " (" + fm(x.p) + "/sq)"} value={lsV[x.id] || 0} onChange={function(v) { var o = Object.assign({}, lsV); o[x.id] = v; setLsV(o); }} step={0.1} />; })}
        </Section>

        <Section title="Gutters">
          {GUTTERS_DATA.map(function(x) { return <NumField key={x.id} label={x.n + " (" + fm(x.p) + "/LF)"} value={gtV[x.id] || 0} onChange={function(v) { var o = Object.assign({}, gtV); o[x.id] = v; setGtV(o); }} />; })}
        </Section>

        <Section title="Siding and Fascia">
          {SIDING_DATA.map(function(x) { return <NumField key={x.id} label={x.n + " (" + fm(x.p) + "/" + x.u + ")"} value={sdV[x.id] || 0} onChange={function(v) { var o = Object.assign({}, sdV); o[x.id] = v; setSdV(o); }} step={x.u === "sq" ? 0.1 : 1} />; })}
        </Section>

        <Section title="Custom Line Items">
          <button onClick={function() { setCisV(cisV.concat([{ de: "", qty: 1, unit: "ea", pr: 0, co: 0 }])); }} style={{ padding: "10px 18px", background: B, color: W, border: "none", borderRadius: 4, fontWeight: 700, fontSize: 12, cursor: "pointer", fontFamily: F, marginBottom: 12, width: "100%" }}>+ ADD CUSTOM ITEM</button>
          {cisV.map(function(x, i) {
            return (<div key={i} style={{ background: G5, borderRadius: 4, padding: 12, marginBottom: 10 }}>
              <Field label="Description" value={x.de} onChange={function(v) { var u = cisV.slice(); u[i] = Object.assign({}, u[i], { de: v }); setCisV(u); }} ph="Description" />
              <NumField label="Quantity" value={x.qty} onChange={function(v) { var u = cisV.slice(); u[i] = Object.assign({}, u[i], { qty: v }); setCisV(u); }} step={0.1} />
              <NumField label="Price per unit" value={x.pr} onChange={function(v) { var u = cisV.slice(); u[i] = Object.assign({}, u[i], { pr: v }); setCisV(u); }} step={0.01} />
              {showCost ? <NumField label="Cost per unit" value={x.co} onChange={function(v) { var u = cisV.slice(); u[i] = Object.assign({}, u[i], { co: v }); setCisV(u); }} step={0.01} /> : null}
              <button onClick={function() { setCisV(cisV.filter(function(_, j) { return j !== i; })); }} style={{ background: LR, color: R, border: "none", borderRadius: 4, padding: "8px 16px", cursor: "pointer", fontWeight: 700, fontSize: 12, width: "100%" }}>REMOVE</button>
            </div>);
          })}
        </Section>

        <Section title="Notes">
          <textarea value={notes} onChange={function(e) { setNotes(e.target.value); }} placeholder="Additional notes..." rows={4} style={{ width: "100%", padding: "10px 12px", border: "1.5px solid " + G4, borderRadius: 4, fontSize: 14, fontFamily: F, color: B, resize: "vertical", boxSizing: "border-box" }} />
        </Section>

        {/* SUMMARY */}
        <Section title="Estimate Summary" accent={B}>
          <div style={{ fontSize: 12, color: G3, marginBottom: 8 }}>Est #{eNum}</div>
          {cust.name ? <div style={{ padding: "10px 12px", background: G5, borderRadius: 4, marginBottom: 12, borderLeft: "3px solid " + R }}>
            <div style={{ fontSize: 15, fontWeight: 700 }}>{cust.name}</div>
            {cust.addr ? <div style={{ fontSize: 12, color: G3 }}>{cust.addr}</div> : null}
          </div> : null}
          {isInsurance && insClaim.company ? <div style={{ padding: "8px 12px", background: "#f0f0ff", borderRadius: 4, marginBottom: 12, fontSize: 12, color: G1 }}>Insurance: {insClaim.company}{insClaim.acv ? " | ACV: " + fm(parseFloat(insClaim.acv)) : ""}</div> : null}

          {lines.length === 0 ? (
            <div style={{ textAlign: "center", padding: "30px 16px", color: G3, fontSize: 14 }}>Add items to see your estimate</div>
          ) : (
            <div>
              {lines.map(function(l, i) {
                return (<div key={i} style={{ padding: "10px 0", borderBottom: "1px solid " + G5 }}>
                  <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start" }}>
                    <div style={{ flex: 1, fontSize: 13, fontWeight: 500, paddingRight: 10, color: G1 }}>{l.d}</div>
                    <div style={{ fontSize: 14, fontWeight: 700, whiteSpace: "nowrap" }}>{fm(l.t)}</div>
                  </div>
                  {l.det ? <div style={{ fontSize: 11, color: G3, marginTop: 2 }}>{l.det}</div> : null}
                  {showCost ? <div style={{ marginTop: 4 }}>
                    <span style={{ fontSize: 11, color: R, fontWeight: 600, marginRight: 12 }}>Cost: {fm(l.tc)}</span>
                    {l.tc != null && l.t > 0 ? <span style={{ fontSize: 11, color: GN, fontWeight: 600 }}>Profit: {fm(l.t - l.tc)} ({((1 - l.tc / l.t) * 100).toFixed(0)}%)</span> : null}
                  </div> : null}
                </div>);
              })}
              <div style={{ marginTop: 16 }}>
                {tot > 0 && tot < 500 ? <div style={{ padding: "8px 12px", background: "#fff8e0", borderRadius: 4, fontSize: 12, color: "#8a6d00", marginBottom: 8, fontWeight: 600 }}>Small job minimum of $500.00 applies</div> : null}
                <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", padding: "14px 16px", background: B, borderRadius: 4 }}>
                  <span style={{ fontSize: 16, fontWeight: 700, color: W, letterSpacing: 1 }}>TOTAL</span>
                  <span style={{ fontSize: 22, fontWeight: 800, color: W }}>{fm(final2)}</span>
                </div>
                {showCost ? <div style={{ marginTop: 8, padding: "12px 14px", background: G5, borderRadius: 4, border: "1px solid " + G4 }}>
                  <div style={{ display: "flex", justifyContent: "space-between", fontSize: 13, marginBottom: 4 }}><span style={{ color: R, fontWeight: 700 }}>Total Cost</span><span style={{ fontWeight: 700 }}>{fm(totC)}</span></div>
                  <div style={{ display: "flex", justifyContent: "space-between", fontSize: 13, marginBottom: 4 }}><span style={{ color: GN, fontWeight: 700 }}>Gross Profit</span><span style={{ fontWeight: 700, color: GN }}>{fm(prof)}</span></div>
                  <div style={{ display: "flex", justifyContent: "space-between", fontSize: 13 }}><span style={{ color: GN, fontWeight: 700 }}>Margin</span><span style={{ fontWeight: 700, color: GN }}>{marg}%</span></div>
                </div> : null}
              </div>
            </div>
          )}
          <button onClick={function() { setIsPrint(true); }} style={{ width: "100%", marginTop: 16, padding: 14, background: R, color: W, border: "none", borderRadius: 4, fontWeight: 700, fontSize: 14, cursor: "pointer", letterSpacing: 1, fontFamily: F }}>PREVIEW AND PRINT</button>
        </Section>

      </div>
    </div>
  );
}

ReactDOM.render(React.createElement(App), document.getElementById("root"));

// Tell parent iframe to resize
function reportHeight() {
  var h = document.body.scrollHeight;
  window.parent.postMessage({ type: 'resize', height: h + 40 }, '*');
}
setInterval(reportHeight, 500);
window.addEventListener('load', reportHeight);

</script>
</body>
</html>
